---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import "../../styles/global.css";

const { id } = Astro.params;
const teamResponse = await fetch(`http://localhost:1234/teams/${id}`);
const teamData = await teamResponse.json();
const team = teamData[0];

const stadiumResponse = await fetch(
  `http://localhost:1234/teams/${id}/stadium`
);
const stadiumData = await stadiumResponse.json();
const stadium = stadiumData[0];

const playersData = await fetch(`http://localhost:1234/teams/${id}/players`);
const players = await playersData.json();

export async function getStaticPaths() {
  const teamsResponse = await fetch("http://localhost:1234/teams");
  const teamsData = await teamsResponse.json();
  const paths = teamsData.map((team: { id: number }) => ({
    params: { id: team.id },
  }));

  return paths;
}

export async function getStaticProps({ params }) {
  const { id } = params;
  const teamResponse = await fetch(`http://localhost:1234/teams/${id}`);
  const teamData = await teamResponse.json();

  if (!teamData) {
    throw new Error("Equipo no encontrado");
  }

  return { props: { teamData } };
}
---

<head>
  <meta charset="UTF-8" />
  <title>{teamData.name}</title>
</head>

<body>
  <Layout>
    <Navbar />
    <div class="py-3 px-5 mt-20">
      {
        (
          <div
            class={`w-full h-auto grid grid-cols-1 sm:h-72 sm:grid-cols-3 grid-rows-3 sm:grid-rows-1 items-center gap-4 rounded-3xl border-2 border-gray-200 p-10`}
            style={`background: radial-gradient(circle, ${team.secondaryColor} 0%, ${team.mainColor} 50%);`}
          >
            <div
              class={`text-center flex flex-col gap-10 ${team.mainColor === "#ffffff" ? "text-[#00001B]" : "text-white"}`}
            >
              <div class="flex flex-col justify-between items-center font-la-liga-font">
                <h1 class="text-4xl font-medium text-center font-la-liga-font">
                  {team.name}
                </h1>
                <div class="flex flex-row justify-center items-end">
                  <p class="text-lg mr-1">EST.</p>
                  <p class="text-2xl">{team.year}</p>
                </div>
              </div>
              <div>
                <p class="font-bold">PRESIDENT</p>
                <p>{team.president}</p>
              </div>
            </div>
            <div>
              <a
                href={team.website}
                target="_blank"
                rel="noreferrer noopener"
                class="flex flex-col hover:scale-105 transition"
              >
                <img src={team.badge} alt={team.name} class="mx-auto h-full" />
              </a>
            </div>
            <div
              class={`grid grid-rows-2 justify-center items-center ${team.mainColor === "#ffffff" ? "text-[#00001B]" : "text-white"}`}
            >
              <div class="text-center">
                <p class="text-2xl font-la-liga-font">{stadium.name}</p>
                <div class="flex flex-row items-center mt-3 justify-between text-center">
                  <div>
                    <p class="font-bold">EST.</p>
                    <p>{stadium.year}</p>
                  </div>
                  <div>
                    <p class="font-bold">CAPACITY</p>
                    <p>{stadium.capacity}</p>
                  </div>
                </div>
              </div>
              <div>
                <a
                  href={`https://www.google.com/maps/search/?api=1&query=${stadium.latitude}%2C${stadium.longitude}`}
                  target="_blank"
                  rel="noreferrer noopener"
                  class="flex flex-col hover:scale-105 transition"
                >
                  <img
                    src={stadium.photo}
                    alt={stadium.name}
                    class="mx-auto h-24"
                  />
                  `
                </a>
              </div>
            </div>
          </div>
        )
      }
    </div>
    <div class="py-3 px-5">
      <nav class="flex flex-row w-full justify-around p-5">
        <div
          id="squad"
          class={`cursor-pointer text-xl hover:border-[#ff4b44] transition border-b-4 border-[#ff4b44] font-bold section w-24 text-center`}
        >
          Squad
        </div>
        <div
          id="results"
          class="cursor-pointer text-xl hover:text-[#ff4b44] hover:border-[#ff4b44] transition border-b-4 section w-24 text-center"
        >
          Results
        </div>
      </nav>

      <section id="squadSection" class="p-10">
        <h2 class="text-3xl text-bold uppercase font-la-liga-font">
          {team.shortName} Squad
        </h2>
        <div class="flex flex-col">
          <div>
            <div class="border-b-2 border-[#00001B] w-full text-start">
              <p class="mt-4 uppercase font-la-liga-font text-2xl pb-2">
                Manager
              </p>
            </div>
            <div>
              <p class="mt-4 text-start">{team.manager}</p>
            </div>
          </div>
          <div>
            <div class="border-b-2 border-[#00001B] w-full text-start">
              <p class="mt-4 uppercase font-la-liga-font text-2xl pb-2">
                Goalkeepers
              </p>
            </div>
            <div
              class="grid justify-items-center grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4 p-3 mt-20"
            >
              {
                players.map((player) =>
                  player.position === "Goalkeeper" ? (
                    <div class="mt-4 text-start">
                      <p
                        class={`text-bold text-5xl font-la-liga-font text-[${team.mainColor}]`}
                      >
                        {player.number}
                      </p>
                      <p
                        class={`text-bold text-2xl font-la-liga-font text-[${team.mainColor}]`}
                      >
                        {player.knownAs !== null
                          ? player.knownAs
                          : player.lastName}
                      </p>
                      <img
                        src={player.photo}
                        alt={player.knownAs}
                        class="w-24 h-24"
                      />
                    </div>
                  ) : null
                )
              }
            </div>
          </div>
        </div>
      </section>
      <!-- Staff Content Goes Here -->
    </div>

    <section id="resultsSection" class="p-10 hidden">
      <h2 class="text-3xl font-semibold text-center">Results</h2>
      <p class="mt-4 text-center">Here you can find the team's results.</p>
      <!-- Results Content Goes Here -->
    </section>
  </Layout>
</body>
<Footer />

<script>
  const sections = document.querySelectorAll("div.section");
  sections.forEach((section) => {
    section.addEventListener("click", () => changeTab(section.id));
  });

  function changeTab(tab: string) {
    const squadSection = document.getElementById("squadSection");
    const resultsSection = document.getElementById("resultsSection");
    const squad = document.getElementById("squad");
    const results = document.getElementById("results");
    if (squadSection && resultsSection) {
      if (tab === "results") {
        squadSection.classList.add("hidden");
        resultsSection.classList.remove("hidden");
        if (squad && results) {
          squad.classList.remove("border-[#ff4b44]");
          squad.classList.remove("font-bold");
          squad.classList.add("hover:text-[#ff4b44]");
          results.classList.add("border-[#ff4b44]");
          results.classList.add("font-bold");
          results.classList.remove("hover:text-[#ff4b44]");
        }
      } else {
        squadSection.classList.remove("hidden");
        resultsSection.classList.add("hidden");
        if (squad && results) {
          squad.classList.add("border-[#ff4b44]");
          squad.classList.add("font-bold");
          squad.classList.remove("hover:text-[#ff4b44]");
          results.classList.remove("border-[#ff4b44]");
          results.classList.remove("font-bold");
          results.classList.add("hover:text-[#ff4b44]");
        }
      }
    }
  }
</script>
